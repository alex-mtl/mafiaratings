var timer=new function(){function m(){if(!(0>=t))try{var b=$("#t-area"),d=b.attr("class"),e=d.indexOf("timer-")+6,r=0<=e?parseInt(d.substr(e,1))+1:1;if(isNaN(r)||1<r)r=0,--t;b.attr("class","timer timer-"+r);setTimeout(m,60)}catch(a){}}function a(b){0>b&&(b=0);var d=Math.floor(b/60);b%=60;10>b&&(b="0"+b);try{$("#timer").html(d+":"+b)}catch(e){}}function h(){var b=0;try{var d=$("#timer").html().split(":");if(0<d.length){var e=0;1==d.length?b=parseInt(d[0]):(e=parseInt(d[0]),isNaN(e)&&(e=0),b=parseInt(d[1]));
isNaN(b)&&(b=0);b+=60*e}}catch(r){}return b}var g=0,f=0,j=0,s=0,t=0,b,r,e=!0;this.hide=function(b,d){$("#clock").html(d);e=!0;b&&(g=0)};this.show=function(u,d,k){e&&($("#clock").html('<table id="t-area" class="timer timer-0" width="100%"><tr><td width="1"><button id="timerBtn" class="timer" onclick="timer.toggle()"><img id="timerImg" src="images/resume_big.png" class="timer"></button></td><td><div id="timer" class="timer"></div></td><td width="1"><button class="timer" onclick="timer.inc(-10)"><img src="images/dec_big.png" class="timer"></button></td><td width="1"><button class="timer" onclick="timer.inc(10)"><img src="images/inc_big.png" class="timer"></button></td></tr></table>'),
e=!1);$("#t-area").attr("class","timer timer-0");b=document.getElementById("end-snd").cloneNode(!0);r=document.getElementById("prompt-snd").cloneNode(!0);t=0;s=parseInt(d);k?(0<g&&($("#timerImg").attr("src","images/resume_big.png"),g=0),j=f=u):(f=j,0<g&&($("#timerImg").attr("src","images/pause_big.png"),g=(new Date).getTime()));a(j);mafia.data().user.settings.flags&2&&timer.start()};this.stop=function(){if(0<g){try{$("#timerImg").attr("src","images/resume_big.png")}catch(b){}g=0}};this.start=function(){if(0>=
g&&(j=f=h(),0<f)){try{$("#timerImg").attr("src","images/pause_big.png")}catch(b){}g=(new Date).getTime()}};this.toggle=function(){0<g?timer.stop():timer.start()};this.inc=function(b){0<g?(isNaN(f)&&(f=0),f+=b,0>f&&(f=0),j=b=f-Math.round(((new Date).getTime()-g)/1E3)):b=h()+b;a(b)};this.tick=function(){if(0<g){var e=f-Math.round(((new Date).getTime()-g)/1E3),d=mafia.data().user.settings.flags;0>=e?(0==(d&4)&&b.play(),0==(d&8)&&(t=15,m()),j=0,a(j),timer.stop()):(h()>s&&e<=s&&(0==(d&4)&&r.play(),0==
(d&8)&&(t=2,m())),j=e,a(e))}}},statusWaiter=new function(){var m=!1;this.start=function(){return!m?(m=!0,$("#saving-img").attr("src","images/save.png"),$("#saving-btn").attr("onclick",""),$("#saving").html(l("Saving")),!0):!1};this.success=function(){m=!1;this.connected(http.connected())};this.error=function(a){m=!1;http.connected()&&($("#saving-img").attr("src","images/warn.png"),$("#saving-btn").attr("onclick","statusWaiter.update()"),$("#saving").html(l("SaveErr",a)))};this.info=function(a,h,g){console.log(a);
g()};this.connected=function(a){var h=mafia.data();a?($("#saving-img").attr("src","images/connected.png"),$("#saving-btn").attr("onclick","http.connected(false)")):($("#saving-img").attr("src","images/disconnected.png"),$("#saving-btn").attr("onclick","mafia.sync()"));null==h?$("#saving").html(""):$("#saving").html(h.club.name)};this.update=function(){this.connected(http.connected())}};
mafia.ui=new function(){function m(b,r,e){return b==r?'<option value="'+b+'" selected>'+e+"</option>":'<option value="'+b+'">'+e+"</option>"}function a(b,r){r?b.removeClass("ui-state-disabled"):b.addClass("ui-state-disabled")}function h(b,r){r?b.removeAttr("disabled"):b.attr("disabled","disabled")}function g(b){if(0==mafia.curVoting().canceled){for(var r,e=0;10>e;++e)if(p=b.players[e],0==p.state){var u=$("#control"+e);mafia.isNominated(e)?(u.addClass("day-grey"),u.html("<center>"+l("Nominated")+"</center>")):
(r='<button class="day-vote" onclick="mafia.nominatePlayer('+e+')"',e==b.current_nominant&&(r+=" checked"),r+=">"+l("Nominate",e+1)+"</button>",u.html(r))}r='<button class="day-vote" onclick="mafia.nominatePlayer(-1)"';0>b.current_nominant&&(r+=" checked");r+=">"+l("NoNom")+"</button>";$("#control-1").html(r)}}var f=!1,j=!1,s=0,t=0;this.mobile=function(b){var r=f;"undefined"!=typeof b&&(f=b);return r};this.updateButtons=function(){var b=mafia.data();$("#back").prop("disabled",!mafia.canBack());a($("#save"),
mafia.localDirty());a($("#sync"),mafia.globalDirty());a($("#club"),null!=b&&1<b.user.clubs.length);b=mafia.curVoting();a($("#voting"),null!=b);null==b||0>=b.canceled?$("#voting-txt").html(l("CancelVoting")):$("#voting-txt").html(l("RestoreVoting"))};this.FLAG_MOBILE=1;this.FLAG_ONLINE=2;this.start=function(b,r,e){var u='<div id="demo">'+l("Demo")+'</div><table class="bordered" width="100%" id="players"><tr class="day-empty header-row" align="center"><td id="head" colspan="6"><table class="transp" width="100%"><tr><td width="50"><button id="ops" class="ops"><img src="images/settings_big.png" border="0" height="54"></button><ul id="ops-menu" style="position:absolute;"><li id="club" class="ops-item"><a href="#" onclick="selectClubForm.show()"><img src="images/gun.png" class="text"> '+
l("ChangeClub")+'</a></li><li type="separator"></li><li id="sync" class="ops-item"><a href="#" onclick="mafia.sync()"><img src="images/sync.png" class="text"> '+l("SendData")+'</a></li><li id="save" class="ops-item"><a href="#" onclick="mafia.ui.save()"><img src="images/save.png" class="text"> '+l("Save")+'</a></li><li type="separator"></li><li id="voting" class="ops-item"><a href="#" onclick="mafia.toggleVoting()"><img src="images/vote.png" class="text"> <span id="voting-txt">'+l("CancelVoting")+
'</span></a></li><li type="separator"></li>';b&this.FLAG_ONLINE&&(u+='<li id="offline" class="ops-item"><a href="#" onclick="mafia.ui.offline()"><img src="images/disconnected.png" class="text"> '+l("Offline")+"</a></li>");for(var u=u+('<li id="settings" class="ops-item"><a href="#" onclick="mafia.ui.settings()"><img src="images/settings.png" class="text"> '+l("Settings")+'</a></li></ul></td><td id="status" align="center"></td><td id="clock" width="320"></td></tr></table></td></tr>'),d=0;10>d;++d)u+=
'<tr class="day-alive player-row" id="r'+d+'"><td width="20" align="center" id="num'+d+'">'+(d+1)+'</td><td id="name'+d+'"></td><td id="panel'+d+'" width="112"></td><td id="control'+d+'" width="160"></td><td id="warn'+d+'" width="100"></td><td width="90"><span id="btns-'+d+'"><button class="icon" onclick="mafia.ui.warnPlayer('+d+')"><img src="images/warn.png"></button><button class="icon" onclick="mafia.ui.suicide('+d+')"><img src="images/suicide.png"></button><button class="icon" onclick="mafia.ui.kickOut('+
d+')"><img src="images/delete.png""></button></span></td></tr>';$("#game-area").html(u+'<tr class="day-empty footer-row" id="r-1"><td colspan="3"><table class="invis"><tr><td><button class="icon" id="saving-btn"><img id="saving-img" border="0"></button></td><td id="saving"></td></tr></table></td><td id="control-1"></td><td id="noms" colspan="2"></td></tr></table><div class="btn-panel"><table class="transp" width="100%"><tr><td><button class="game-btn" id="back" onclick="mafia.ui.back()"><img src="images/prev.png" class="text"></button></td><td id="info" align="center"></td><td align="right"><button class="game-btn" id="next" onclick="mafia.ui.next()"><img src="images/next.png" class="text"></button></td></tr></table></div><audio id="end-snd" src="sound/end.mp3" preload></audio><audio id="prompt-snd" src="sound/10sec.mp3" preload></audio>');
var a=$("#ops-menu").menu().hide();$("#ops").click(function(){a.show(0,function(){a.position({my:"left top",at:"left bottom",of:$("#ops")});$(document).one("click",function(){a.hide()})});return!1});window.onbeforeunload=function(){mafia.save()};dialogWaiter.connected=silentWaiter.connected=statusWaiter.connected;mafia.ui.mobile(0!=(b&this.FLAG_MOBILE));mafia.stateChange(mafia.ui.sync);mafia.dirtyEvent(mafia.ui.updateButtons);mafia.failEvent(function(b){dlg.error(b)});"object"!=typeof localStorage&&
dlg.info(l("ErrNoStorage"));mafia.sync(r,e,function(){mafia.ui.fillUsers();setInterval(function(){var b=mafia.data().user.settings;s+=10;t+=10;t>=b.g_autosave?(b=!0,t=0,http.connected()&&mafia.globalDirty()&&(b=http.waiter(statusWaiter),mafia.sync(),http.waiter(b),b=!1),b&&mafia.save(),s>=b.l_autosave&&(s=0)):s>=b.l_autosave&&(s=0,mafia.save())},1E4)})};this.sync=function(b){var r=mafia.data(),e=r.club,a=r.game,d=r.user,k="",f=null,h=mafia.curVoting(),r=0!=(b&1),s=0,t,w="";r&&(j=!1);b&2&&statusWaiter.update();
b&4&&mafia.ui.fillUsers();$("#control-1").html("");if(0==a.gamestate){k='<table width="100%"><tr><td><table><tr><td>'+l("Event")+":</td>";d.manager&&(k+='<td><button class="icon" onclick="eventForm.show()"><img src="images/create.png" class="icon"></button></td>');var k=k+('<td><select id="events" onchange="mafia.ui.eventChange(false)"></select></td></td></tr></table></tr><tr><td align="left">'+l("Rules")+': <select id="rules" onchange="mafia.ui.rulesChange()">'),f=mafia.sRules(),c;for(c in f)h=f[c],
w=e.rules[h].name,0==w.length&&(w=l("DefRules")),k+=m(h,a.rules_id,w);k+="</select></td></tr></table>";w='<table width="100%"><tr><td align="right">'+l("Lang")+': <select id="lang" onchange="mafia.ui.langChange()"></select></td></tr>';w+='</select></td></tr><tr><td align="right"><table><tr><td>'+l("Moder")+':</td><td><button id="reg-moder" class="icon" onclick="mafia.ui.register(10)"><img src="images/user.png" class="icon"></button></td><td><select id="player10" onchange="mafia.ui.playerChange(10)"></select></td></tr></table></td></tr></table></td></tr></table>';
for(c=0;10>c;++c)$("#btns-"+c).hide(),$("#name"+c).removeClass(),$("#num"+c).removeClass(),$("#warn"+c).html("").removeClass(),$("#panel"+c).html("").removeClass(),$("#control"+c).html("").removeClass(),$("#r"+c).removeClass().addClass("day-alive");$("#r-1").removeClass().addClass("day-empty");$("#head").removeClass().addClass("day-empty");f=mafia.ui.fillEvents;$("#info").html("");$("#noms").html("")}else if(25==a.gamestate){mafia.ui.fillUsers();d=(q=0<mafia.playersCount(!1))?"night-":"day-";c=d+
"empty";$("#r-1").removeClass().addClass(c);$("#head").removeClass().addClass(c);for(c=0;10>c;++c){var v=a.players[c];$("#warn"+c).html("");$("#btns-"+c).hide();$("#r"+c).removeClass().addClass(d+"alive");$("#num"+c).removeClass();e="<center>";switch(v.role){case 1:e+=l("sheriff");break;case 2:e+=l("mafia");break;case 3:e+=l("don");break;default:e+=""}$("#panel"+c).html(e+"</center>").removeClass();e="";0!=(mafia.gameRules.flags&256)&&(e='<button class="day-vote" onclick="mafia.bestPlayer('+c+')"',
c==a.best_player&&(e+=" checked"),e+="> "+l("BestPlayer",c+1)+"</button>");$("#control"+c).html(e).removeClass();e="";0!=(mafia.gameRules.flags&512)&&(e='<button class="day-vote" onclick="mafia.bestMove('+c+')"',c==a.best_move&&(e+=" checked"),e+="> "+l("BestMove",c+1)+"</button>");$("#warn"+c).html(e)}k="<h3>"+(q?l("MafWin"):l("CivWin"))+"</h3>"+l("Finish");e="";if(0!=(mafia.gameRules.flags&256)){e='<button class="day-vote" onclick="mafia.bestPlayer(-1)"';if(0>a.best_player||9<a.best_player)e+=" checked";
e+="> "+l("NoBest")+"</button>"}$("#control-1").html(e);e="";if(0!=(mafia.gameRules.flags&512)){e='<button class="day-vote" onclick="mafia.bestMove(-1)"';if(0>a.best_move||9<a.best_move)e+=" checked";e+="> "+l("NoBest")+"</button>"}$("#noms").html(e);$("#info").html("")}else{d=mafia.isNight()?"night-":"day-";c=d+"empty";b="Day";$("#r-1").removeClass().addClass(c);$("#head").removeClass().addClass(c);for(c=0;10>c;++c){v=a.players[c];switch(v.warnings){case 0:$("#warn"+c).html("");break;case 1:$("#warn"+
c).html(l("WarningText"));break;default:$("#warn"+c).html(l("WarningsText",v.warnings))}0!=v.state?$("#btns-"+c).hide():$("#btns-"+c).show();$("#r"+c).removeClass().addClass(d+(0==v.state?"alive":"dead"));$("#num"+c).removeClass();$("#panel"+c).html("").removeClass();$("#control"+c).html("").removeClass()}var q;switch(a.gamestate){case 1:k=l("AssignRoles");q=[];for(c=0;10>c;++c)d=a.players[c],b=d.role,$("#panel"+c).html('<button class="night-char" id="role-'+c+'-0" onclick="mafia.setPlayerRole('+
c+', 0)"><img class="role-icon" src="images/civ.png"></button><button class="night-char" id="role-'+c+'-1" onclick="mafia.setPlayerRole('+c+', 1)" title="'+l("sheriff")+'"><img class="role-icon" src="images/sheriff.png"></button><button class="night-char" id="role-'+c+'-2" onclick="mafia.setPlayerRole('+c+', 2)" title="'+l("mafia")+'"><img class="role-icon" src="images/maf.png"></button><button class="night-char" id="role-'+c+'-3" onclick="mafia.setPlayerRole('+c+', 3)" title="'+l("don")+'"><img class="role-icon" src="images/don.png"></button>'),
$("#control"+c).html('<select id="role-'+c+'" onchange="mafia.ui.setRole('+c+')"><option value="0"></option><option value="1">'+l("sheriff")+'</option><option value="2">'+l("mafia")+'</option><option value="3">'+l("don")+"</option></select>"),$("#role-"+c+"-"+b).attr("checked",""),$("#role-"+c).val(b),0!=d.id&&e.players[d.id].flags&1024&&q.push(d);if(0<q.length){e='<table class="bordered" width="100%">';for(c=0;c<q.length;++c)d=q[c],e+='<tr><td width="24" align="center">'+(d.number+1)+"</td><td>"+
mafia.userTitle(d.id)+"</td></tr>"}b="Night0";$("#control-1").html('<button class="day-vote" onclick="mafia.generateRoles()">'+l("GenRoles")+"</button>");mafia.ui.fillUsers();break;case 2:k=l("Arrange");for(c=0;10>c;++c)d=a.players[c],$("#panel"+c).html('<button class="night-char" id="arr-'+c+'-x" onclick="mafia.arrangePlayer('+c+', -1)">x</button><button class="night-char" id="arr-'+c+'-0" onclick="mafia.arrangePlayer('+c+', 0)">1</button><button class="night-char" id="arr-'+c+'-1" onclick="mafia.arrangePlayer('+
c+', 1)">2</button><button class="night-char" id="arr-'+c+'-2" onclick="mafia.arrangePlayer('+c+', 2)">3</button>'),b=d.has_immunity?l("Immun"):"",$("#control"+c).html('<select id="arr-'+c+'" onchange="mafia.ui.arrangePlayer('+c+')" style="width:120px;"><option value="-1">'+b+'</option><option value="0">'+l("ArrNight",1)+'</option><option value="1">'+l("ArrNight",2)+'</option><option value="2">'+l("ArrNight",3)+'</option><option value="3">'+l("ArrNight",4)+'</option><option value="4">'+l("ArrNight",
5)+"</option></select>"),0<=d.arranged&&$("#arr-"+c+"-"+d.arranged).attr("checked",""),$("#arr-"+c).val(d.arranged),2==d.role?$("#num"+c).addClass("night-mark"):3==d.role&&$("#r"+c).removeClass().addClass("night-mark");s=mafia.gameRules.st_reg;t=mafia.gameRules.spt_reg;b="Night0";break;case 3:k=l("GoodMorning");0!=a.round&&(0<=a.player_speaking?($("#r"+a.player_speaking).removeClass().addClass("day-mark"),d=a.players[a.player_speaking],k=d.is_male?k+(" "+l("NightKill",mafia.playerTitle(d.number),
l("KilledMale"))+" "+l("LastSpeech",l("He"),l("his"))):k+(" "+l("NightKill",mafia.playerTitle(d.number),l("KilledFemale"))+" "+l("LastSpeech",l("She"),l("her"))),s=mafia.gameRules.st_killed,t=mafia.gameRules.spt_killed,mafia.gameRules.flags&16&&g(a)):k+=" "+l("NobodyKilled"));k=mafia.gameRules.flags&2?k+(" "+l("NextFree")):k+(" "+l("NextFloor",mafia.playerTitle(mafia.nextPlayer(-1))));break;case 21:d=a.players[a.player_speaking];k=l("DayGuess",mafia.playerTitle(d.number));$("#r"+a.player_speaking).removeClass().addClass("day-mark");
for(c=0;10>c;++c)d=$("#control"+c),e='<button class="day-vote" onclick="mafia.guess('+c+')"',mafia.isGuessed(c)&&(e+=" checked"),e+="> "+l("guess",c+1)+"</button>",d.html(e);$("#control-1").html('<button class="day-vote" onclick="mafia.noGuess()">'+l("noGuess")+"</button>");break;case 5:d=a.players[a.player_speaking];d.mute!=a.round?(k=l("Speaking",mafia.playerTitle(d.number)),s=mafia.gameRules.st_reg,t=mafia.gameRules.spt_reg):j||mafia.gameRules.flags&16384&&4>=mafia.playersCount()?(k=l("SpeakingShort",
mafia.playerTitle(d.number)),s=mafia.gameRules.st_def,t=mafia.gameRules.spt_def):(d.is_male?(k=l("he"),w=l("his"),c=l("him_")):(k=l("she"),w=l("her"),c=l("her_")),k=l("MissingSpeech",mafia.playerTitle(d.number),k,w),w='<button class="warn3" onclick="mafia.ui.shortSpeech()">'+l("LetSpeak",c)+'</button><button class="warn3" onclick="mafia.postponeMute()">'+l("PostponeBan")+"</button>");q=mafia.nextPlayer(a.player_speaking);k=0<=q?k+(" "+l("NextFloor",mafia.playerTitle(q))):k+(" "+l("NextVoting"));g(a);
$("#r"+a.player_speaking).removeClass().addClass("day-mark");break;case 7:d=a.players[a.player_speaking];$("#r"+a.player_speaking).removeClass().addClass("day-mark");mafia.isKillingThisDay()?(k=d.is_male?l("DayKill",mafia.playerTitle(d.number),l("KilledMale"))+" "+l("LastSpeech",l("He"),l("his")):l("DayKill",mafia.playerTitle(d.number),l("KilledFemale"))+" "+l("LastSpeech",l("She"),l("her")),s=mafia.gameRules.st_killed,t=mafia.gameRules.spt_killed):(k=l("DayKill",mafia.playerTitle(d.number),l("distrusted"))+
" "+l("Speaking",d.is_male?l("He"):l("She")),s=mafia.gameRules.st_def,t=mafia.gameRules.spt_def);q=mafia.votingWinners();d=a.current_nominant+1;k=d<q.length?k+(" "+l("NextFloor",mafia.playerTitle(q[d]))):k+(" "+l("StartNight"));break;case 8:if(0<h.canceled)k=l("VotingCanceled")+" "+l("StartNight");else if(a.flags&2){k=l("DoSimpVoting");q=h.nominants;for(c=0;c<q.length;++c)d=q[c].player_num,e=mafia.isKillingThisDay()?a.players[d].is_male?l("KilledMale"):l("KilledFemale"):l("distrusted"),mafia.votingWinner(c)?
$("#control"+q[c].player_num).html('<button class="day-vote" onclick="mafia.votingWinner('+c+', 0)" checked>'+e+"</button>"):$("#control"+q[c].player_num).html('<button class="day-vote" onclick="mafia.votingWinner('+c+', 1)">'+e+"</button>")}else{e="";q=h.nominants;d=a.current_nominant;v=q[d].player_num;for(c=0;c<q.length;++c)$("#panel"+q[c].player_num).html("<center>"+q[c].count+"</center>").addClass("day-mark");$("#r"+v).removeClass().addClass("day-mark");d+1<q.length?k=l("Voting",mafia.playerTitle(v),
mafia.playerTitle(q[d+1].player_num)):(k=l("VotingLast",mafia.playerTitle(v)),e=" disabled");q=h.votes;for(c=0;10>c;++c)d=a.players[c],0==d.state&&(q[c]==a.current_nominant?$("#control"+c).html('<button class="day-vote" onclick="mafia.vote('+c+', false)" checked>'+l("vote",c+1,v+1)+"</button>"):q[c]>a.current_nominant&&$("#control"+c).html('<button class="day-vote" onclick="mafia.vote('+c+', true)" '+e+">"+l("vote",c+1,v+1)+"</button>"))}break;case 9:0<h.canceled?k=l("VotingCanceled")+" "+l("StartNight"):
(q=mafia.votingWinners(),4==mafia.playersCount()&&2==q.length&&0!=(mafia.gameRules.flags&8)?k=l("NoOneKilled"):mafia.isKillingThisDay()?0<h.voting_round?3==mafia.playersCount()?k=l("ThreeVoters",q.length):(k=l("AllOrNoOne",q.length),w='<button id="ka"'+(mafia.votingKillAll()?" checked":"")+' class="warn3" onclick="mafia.votingKillAll(true)">'+l("All")+'</button><button id="kn"'+(mafia.votingKillAll()?"":"checked")+' class="warn3" onclick="mafia.votingKillAll(false)">'+l("Nobody")+"</button>"):(k=
l("RepeatVoting",q.length)+" ",k=0<q.length?k+l("NextFloor",mafia.playerTitle(q[0])):k+(" "+l("NextVoting"))):(k=l("MultipleDistrust",q.length)+" ",k=0<q.length?k+l("NextFloor",mafia.playerTitle(q[0])):k+(" "+l("StartNight"))));break;case 10:if(0<h.canceled)k=l("VotingCanceled")+" "+l("StartNight");else{q=h.nominants;for(c in q)$("#num"+q[c].player_num).removeClass().addClass("day-mark");$("#r"+a.player_speaking).removeClass().addClass("day-mark");s=mafia.gameRules.st_def;t=mafia.gameRules.spt_def;
k=l("Speaking",mafia.playerTitle(a.player_speaking))+" ";d=a.current_nominant+1;k=d<q.length?k+l("NextFloor",mafia.playerTitle(q[d].player_num)):mafia.isKillingThisDay()?k+l("NextVoting"):k+l("StartNight")}break;case 11:k=l("NightStart");b="Night";break;case 12:v=mafia.shots();k=l("Shooting");e=')"><option value="-1"></option>';for(c=0;10>c;++c)if(d=a.players[c],0==d.state){e+='<option value="'+c+'">'+(c+1);0!=d.id&&(e+=": "+mafia.userTitle(d.id));e+="</option>";b='<button class="night-char" onclick="mafia.shoot('+
c+')">x</button>';for(q in v)b+='<button class="night-char"',v[q]==c&&(b+=" checked"),b+=' onclick="mafia.shoot('+c+", "+q+')">'+(parseInt(q)+1)+"</button>";$("#panel"+c).html(b)}e+="</select>";for(c in v)$("#control"+c).html('<select id="shot'+c+'" onchange="mafia.ui.shoot('+c+e),$("#shot"+c).val(v[c]);b="Night";break;case 13:if(mafia.canDonCheck()){k=l("DonCheck");q=!0;for(c=0;10>c;++c)d=a.players[c],d.don_check==a.round?(b=1==d.role?"yes":"no",$("#control"+c).html('<button class="night-vote" onclick="mafia.donCheck('+
c+')" checked> '+l(b)+"</button>"),q=!1):0>d.don_check&&2>d.role&&$("#control"+c).html('<button class="night-vote" onclick="mafia.donCheck('+c+')"> '+l("Check",c+1)+"</button>");$("#control-1").html('<button class="day-vote" onclick="mafia.donCheck(-1)"'+(q?" checked":"")+"> "+l("NoCheck")+"</button>")}else k=l("NoDon");b="Night";break;case 15:if(mafia.canSheriffCheck()){k=l("SheriffCheck");q=!0;for(c=0;10>c;++c)d=a.players[c],d.sheriff_check==a.round?(b=2<=d.role?"yes":"no",$("#control"+c).html('<button class="night-vote" onclick="mafia.sheriffCheck('+
c+')" checked> '+l(b)+"</button>"),q=!1):0>d.sheriff_check&&1!=d.role&&$("#control"+c).html('<button class="night-vote" onclick="mafia.sheriffCheck('+c+')"> '+l("Check",c+1)+"</button>");$("#control-1").html('<button class="day-vote" onclick="mafia.sheriffCheck(-1)"'+(q?" checked":"")+"> "+l("NoCheck")+"</button>")}else k=l("NoSheriff");b="Night";break;case 20:k=l("FreeDisc"),s=mafia.gameRules.st_free,t=mafia.gameRules.spt_free}$("#info").html(l(b,a.round+1));null!=h&&0>=h.canceled&&0<h.nominants.length?
$("#noms").html('<button class="noms" onclick="mafia.ui.showNominants()">'+l("ShowNoms")+"</button>"):$("#noms").html("")}0<s?timer.show(s,t,r):timer.hide(r,w);$("#status").html(k);null!=f&&f();mafia.ui.updateButtons()};this.showNominants=function(){for(var b=mafia.data().game,a=mafia.curVoting(),e='<table class="bordered" width="100%">',g=0;g<a.nominants.length;++g)p=b.players[a.nominants[g].player_num],e+='<tr><td width="24" align="center">'+(p.number+1)+"</td><td>"+mafia.userTitle(p.id)+"</td></tr>";
dlg.info(e+"</table>",l("Noms"))};this.fillEvents=function(){var b=mafia.time(),a=mafia.data(),e=a.club,g=a.game,a=a.user,d="",k=mafia.sEvents(),f;for(f in k){var h=k[f],j=e.events[h],s=parseInt(j.start_time),t=s+parseInt(j.duration);s<=b&&t+28800*a.manager>b&&(s=new Date(1E3*s),j=j.name,0!=h&&(j=s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear()+": "+j,t+a.manager<=b&&(j+=" ("+l("EvOver")+")")),d+=m(h,g.event_id,j))}$("#events").html(d);mafia.ui.eventChange(!0)};this.eventChange=function(b){var a=
mafia.data(),e=a.club,g=a.game,d=$("#events").val();"undefined"==typeof d&&(d=g.event_id);e=e.events[d];a=a.user;mafia.eventId(d);b||mafia.setRules(e.rules_id);b="";e.langs-1&e.langs&&(b+=m(0,g.lang,""));e.langs&1&&(b+=m(1,g.lang,l("Eng")));e.langs&2&&(b+=m(2,g.lang,l("Rus")));h($("#lang").html(b),!0);h($("#rules").val(g.rules_id),!0);d=mafia.sReg(e.id);if(e.flags&8){$("#reg-moder").show();b=m(0,g.moder_id,"");for(var f in d)e=d[f],b+=m(e,g.moder_id,mafia.userTitle(e))}else $("#reg-moder").hide(),
b=m(a.id,a.id,a.name);h($("#player10").html(b),!0);mafia.ui.fillUsers()};this.fillUsers=function(){var b=mafia.data(),a=b.club,b=b.game,e=a.events[b.event_id],g=mafia.sReg(b.event_id);if(25!=b.gamestate){html=m(0,-1,"");for(var d in g){var f=g[d];if(a.players[f].flags&1&&(b.moder_id!=f||0==b.gamestate&&e.flags&8))html+=m(f,-1,mafia.userTitle(f))}for(d=0;10>d;++d)$("#name"+d).html('<table class="invis"><tr><td><button id="reg-'+d+'" class="icon" onclick="mafia.ui.register('+d+')"><img src="images/user.png" class="icon"></button></td><td><button id="reg-new-'+
d+'" class="icon" onclick="newUserForm.show('+d+')"><img src="images/create.png" class="icon"></button></td><td><select id="player'+d+'" onchange="mafia.ui.playerChange('+d+')"></select></td></tr></table>'),$("#player"+d).html(html).val(b.players[d].id),0==e.id?$("#reg-new-"+d).hide():$("#reg-new-"+d).show();0!=e.id||0<=window.navigator.userAgent.indexOf("MSIE")?$("#demo").hide():$("#demo").show()}else for(d=0;10>d;++d)$("#name"+d).html(mafia.userTitle(b.players[d].id))};this.langChange=function(){mafia.setLang($("#lang").val())};
this.rulesChange=function(){mafia.setRules($("#rules").val())};this.playerChange=function(b){var a=$("#player"+b).val();b=mafia.player(b,a);0<=b&&$("#player"+b).val(-1)};this.register=function(b){regForm.show(b)};this.setRole=function(b){mafia.setPlayerRole(b,$("#role-"+b).val())};this.arrangePlayer=function(b){mafia.arrangePlayer(b,$("#arr-"+b).val())};this.shoot=function(b){mafia.shoot(parseInt($("#shot"+b).val()),b)};this.restart=function(){dlg.yesNo(l("Restart"),null,null,mafia.restart)};this.next=
function(){if(mafia.canNext()){var b=mafia.data(),a=b.game;if(0==a.gamestate){var e=b.club.events[a.event_id],b=mafia.time();if(parseInt(e.start_time)+parseInt(e.duration)<b){b='<table class="dialog_form" width="100%"><tr><td colspan="2">'+l("EventExp")+'</td></tr><tr><td width="80">'+l("Extend")+'</td><td><select id="ext">';for(a=1;12>=a;++a)b+='<option value="'+3600*a+'">'+l("MoreHours",a)+"</option>";for(a=1;5>=a;++a)b+='<option value="'+86400*a+'">'+l("MoreDays",a)+"</option>";dlg.yesNo(b+"</select></td></tr></table>",
null,null,function(){mafia.extendEvent(e.id,$("#ext").val());mafia.next()});return}}else if(25==a.gamestate){b=null;if(0!=(mafia.gameRules.flags&256)&&(0>a.best_player||9<a.best_player))b=l("NoBestPlayer");else if(0!=(mafia.gameRules.flags&512)&&(0>a.best_move||9<a.best_move))b=l("NoBestMove");if(null!=b){dlg.yesNo(b,null,null,function(){mafia.next()});return}}else if(8==a.gamestate&&a.flags&2){var a=mafia.votingWinners().length,g=mafia.playersCount(),b=null;0==a?b=l("ErrEnterKills"):0!=g%a&&(b=l("ErrKillsNotAliquot",
g,a));if(null!=b){dlg.error(b);return}}mafia.next()}else gameStartForm.show(mafia.ui.next)};this.suicide=function(b){dlg.yesNo(l("ConfirmSuicide",mafia.playerTitle(b)),null,null,function(){mafia.suicide(b)})};this.kickOut=function(b){dlg.yesNo(l("ConfirmKickOut",mafia.playerTitle(b)),null,null,function(){mafia.kickOut(b)})};this.warnPlayer=mafia.warnPlayer;this.back=mafia.back;this.save=mafia.save;this.nextRole=function(b){var a=mafia.data().game.players[b].role+1;3<a&&(a=0);mafia.setPlayerRole(b,
a)};this.keyUp=function(b){var a=mafia.data().game;if(13==b)mafia.ui.next();else if(46==b)mafia.canBack()&&mafia.ui.back();else switch(a.gamestate){case 0:49<=b&&57>=b?mafia.ui.register(b-49):48==b?mafia.ui.register(9):45==b&&eventForm.show();break;case 1:49<=b&&57>=b?mafia.ui.nextRole(b-49):48==b&&mafia.ui.nextRole(9)}};this.settings=function(){settingsForm.show()};this.shortSpeech=function(){var b=mafia.data().game;j=!0;$("#status").html(l("SpeakingShort",mafia.playerTitle(b.players[b.player_speaking].number)));
timer.show(mafia.gameRules.st_def,mafia.gameRules.spt_def,!0)};this.offline=function(){dlg.info(l("OfflineText",f?"mob-":""),l("Offline"))}};
var nickForm=new function(){var m;this.show=function(a,h){m=a;var g='<table class="dialog_form" width="100%"><tr><td colspan="2">'+l("EnterNick",a.name)+':</td></tr><tr><td width="90">'+l("Nick")+':</td><td><select id="nf-nicks" onchange="nickForm.onSelect()"></select> <input id="nf-nick" onkeyup="nickForm.onChange()"></td></tr><tr id="nf-sex"><td>'+l("Gender")+':</td><td><input type="radio" name="nf-sex" id="nf-male" checked> '+l("male")+' <input type="radio" name="nf-sex" id="nf-female"> '+l("female")+
"</td></tr></table><script>$(nickForm.init);\x3c/script>";dlg.okCancel(g,l("Nick"),500,function(){var a=m.flags;"undefined"==typeof m.flags&&(a=$("#nf-male").attr("checked")?65:1);h($("#nf-nick").val(),a)})};this.init=function(){"undefined"!=typeof m.flags&&$("#nf-sex").hide();var a='<option value=""></option><option value="'+m.name+'">'+m.name+"</option>",h=m.name,g=h.toLocaleLowerCase(),f=0;for(n in m.nicks){var j=parseInt(m.nicks[n]);g==n.toLocaleLowerCase()?n=m.name:a+='<option value="'+n+'">'+
n+"</option>";j>f&&(f=j,h=n)}$("#nf-nick").val(h);$("#nf-nicks").html(a).val(h)};this.onSelect=function(){$("#nf-nick").val($("#nf-nicks").val()).focus()};this.onChange=function(){$("#nf-nicks").val("")}},eventForm=new function(){var m;this.show=function(){var a='<table class="dialog_form" width="100%"><tr><td width="160">'+l("EventName")+':</td><td><input id="form-name"></td></tr><tr><td>'+l("Duration")+':</td><td><select id="form-duration"><option value="3600">1</option><option value="7200">2</option><option value="10800">3</option><option value="14400">4</option><option value="18000">5</option><option value="21600">6</option><option value="25200">7</option><option value="28800">8</option><option value="32400">9</option><option value="36000">10</option><option value="39600">11</option><option value="43200">12</option><option value="86400">24</option><option value="172800">48</option><option value="259200">72</option><option value="345600">96</option><option value="432000">120</option></select> '+
l("hours")+"</td></tr><tr><td>"+l("Address")+':</td><td><select id="form-addr" onChange="eventForm.addrClick()"></select><div id="form-new_addr_div">'+l("Address")+': <input id="form-new_addr" onkeyup="eventForm.addrChange()"><br>'+l("City")+': <input id="form-city"><br>'+l("Country")+': <input id="form-country"></span></td></tr><tr><td>'+l("Price")+':</td><td><input id="form-price"></td></tr><tr><td>'+l("Rules")+':</td><td><select id="form-rules"></select></td></tr><tr><td>'+l("Langs")+':</td><td id="form-langs"></td></tr><tr><td colspan="2"><input type="checkbox" id="form-all_mod" checked> '+
l("AllModer")+"</td></tr></table><script>$(eventForm.init);\x3c/script>";dlg.okCancel(a,l("CreateEvent"),600,function(){try{var a=$("#form-addr").val(),g=$("#form-all_mod").attr("checked")?8:0,f=0;$("#form-en").attr("checked")&&(f|=1);$("#form-ru").attr("checked")&&(f|=2);var j={name:$("#form-name").val(),duration:$("#form-duration").val(),price:$("#form-price").val(),rules:$("#form-rules").val(),langs:f,flags:g};0<a?j.addr_id=a:(j.addr=$("#form-new_addr").val(),j.country=$("#form-country").val(),
j.city=$("#form-city").val());mafia.eventId(mafia.createEvent(j));mafia.ui.fillEvents()}catch(m){handleError(m)}})};this.addrChange=function(){var a=$("#form-new_addr").val();$("#form-name").val()==m&&$("#form-name").val(a);m=a};this.addrClick=function(){var a="";0>=$("#form-addr").val()?$("#form-new_addr_div").show():($("#form-new_addr_div").hide(),a=$("#form-addr option:selected").text());$("#form-name").val()==m&&$("#form-name").val(a);m=a};this.langCheck=function(a){!$("#form-en").attr("checked")&&
!$("#form-ru").attr("checked")&&(1==a?$("#form-en").attr("checked",!0):$("#form-ru").attr("checked",!0))};this.init=function(){m="";for(var a=mafia.data().club,h='<option value="0">'+l("NewAddr")+"</option>",g=0;g<a.addrs.length;++g){var f=a.addrs[g],h=h+('<option value="'+f.id+'"');0==g&&(h+=" selected");h+=">"+f.name+"</option>"}$("#form-addr").html(h);$("#form-duration").val(21600);$("#form-price").val(a.price);$("#form-country").val(a.country);$("#form-city").val(a.city);h="";f=mafia.sRules();
for(g in f){var j=f[g],s=a.rules[j].name;0==s.length&&(s=l("DefRules"));h+='<option value="'+j+'">'+s+"</option>"}$("#form-rules").html(h);h="";a.langs&1&&(h+='<input type="checkbox" id="form-en" onclick="eventForm.langCheck(1)" checked> '+l("Eng")+" ");a.langs&2&&(h+='<input type="checkbox" id="form-ru" onclick="eventForm.langCheck(2)" checked> '+l("Rus")+" ");$("#form-langs").html(h);eventForm.addrClick()}},regForm=new function(){function m(a){var f=mafia.data(),j=f.club,m=j.players;"undefined"!=
typeof j.events[f.game.event_id].reg[a]?($("#player"+h).val(a),mafia.ui.playerChange(h),"undefined"!=typeof onSuccess&&onSuccess()):("undefined"!=typeof onSuccess&&onSuccess(),nickForm.show(m[a],function(f){try{mafia.register(f,a),mafia.player(h,a),mafia.ui.eventChange(!1)}catch(b){handleError(b)}}))}function a(a,f,j,m){var t=mafia.data();"undefined"!=typeof t.club.events[t.game.event_id].reg[j]?($("#player"+h).val(j),mafia.ui.playerChange(h)):(t={},""!=f&&(t[f]=1),f={name:a,nicks:t},0!=j&&(f.id=
j,f.flags=m),nickForm.show(f,function(b,f){try{j=mafia.regIncomer(a,b,j,f),mafia.player(h,j),mafia.ui.eventChange(!1)}catch(e){handleError(e)}}))}var h;this.show=function(g){h=g;g='<table class="dialog_form" width="100%"><tr><td><table class="invis" width="100%"><tr><td>';g=mafia.ui.mobile()?g+('<input type="checkbox" id="form-club" onclick="regForm.nameChange()"> '+l("Incomer")+'</td><td align="right"><input id="form-name" onkeyup="regForm.nameChange()">'):g+('<input id="form-name" onkeyup="regForm.nameChange()"></td><td align="right"><input type="checkbox" id="form-club" onclick="regForm.nameChange()"> '+
l("Incomer"));g+='</td></tr></table></td></tr><tr><td><table class="reg-list" width="100%">';for(var f=0;10>f;++f){g+="<tr>";for(var j=0;5>j;++j)g+='<td width="20%" id="form-u'+(f+10*j)+'">&nbsp;</td>';g+="</tr>"}dlg.okCancel(g+"</table></td></tr></table><script>$(regForm.init);\x3c/script>",l("Register"),800,function(){var g=$("#form-name").val();if(""==g)dlg.error(l("ErrNoUserName"));else{var f=mafia.findPlayer(g);null!=f?m(f.id):$("#form-club").attr("checked")?a(g,"",0,0):dlg.error(l("ErrUserNotFound",
g))}})};this.init=function(){regForm.nameChange()};this.nameChange=function(){var a=mafia.data().club,f=$("#form-name").val().toLocaleLowerCase(),j=0;if($("#form-club").attr("checked")){for(;50>j;++j)$("#form-u"+j).html("&nbsp;");var m=http.waiter(silentWaiter);json.post("game_ops.php",{ulist:"",club:a.id,name:f,num:50},function(a){j=0;for(var b in a.list){var d=a.list[b],e="",c;for(c in d.nicks){e=c;break}d='<a href="#" onclick="regForm.regIncomer(\''+d.name+"', '"+e+"', "+d.id+", "+d.flags+')">'+
d.name;""!=e&&(d+=" ("+e+")");d+="</a>";$("#form-u"+j).html(d);++j}});http.waiter(m)}else{var m=function(a,b){return 0==b.indexOf(a)||0<=b.indexOf(" "+a)||0<=b.indexOf("_"+a)||0<=b.indexOf("-"+a)},t=a.players,a=""==f?a.haunters:mafia.sPlayers(),b=1;10<=h&&(b+=2);for(var r in a){var e=t[a[r]];if(0!=(e.flags&b)){a:{var u=j;if(""==f)$("#form-u"+u).html('<a href="#" onclick="regForm.register('+e.id+')">'+e.name+"</a>"),++u;else{var d=e.name.toLocaleLowerCase();if(m(f,d)&&($("#form-u"+u).html('<a href="#" onclick="regForm.register('+
e.id+')">'+e.name+"</a>"),50<=++u)){j=u;break a}var k=void 0;for(k in e.nicks){var x=k.toLocaleLowerCase();if(d!=x&&m(f,x)&&($("#form-u"+u).html('<a href="#" onclick="regForm.register('+e.id+')">'+e.name+" ("+k+")</a>"),50<=++u)){j=u;break a}}}j=u}if(50<=j)break}}for(;50>j;++j)$("#form-u"+j).html("&nbsp;")}};this.register=function(a){var f=dlg.curId();m(a);dlg.close(f)};this.regIncomer=function(g,f,j,h){var m=dlg.curId();a(g,f,j,h);dlg.close(m)}},newUserForm=new function(){this.show=function(m,a,
h,g,f){"string"!=typeof h&&(h="");"string"!=typeof g&&(g="");"undefined"==typeof f&&(f=!0);var j='<table class="dialog_form" width="100%">';"string"==typeof a&&(j+='<tr><td colspan="2"><b>'+a+"</b></td></tr>");j+='<tr><td width="140">'+l("UserName")+':</td><td><input id="form-name" value="'+h+'"></td></tr><tr><td>'+l("Email")+':</td><td><input id="form-email" value="'+g+'"></td></tr><tr><td>'+l("Gender")+':</td><td><input type="radio" name="form-sex" id="form-male"'+(f?" checked":"")+"> "+l("male")+
' <input type="radio" name="form-sex" id="form-female"'+(f?"":" checked")+"> "+l("female")+"</td></tr></table>";dlg.okCancel(j,l("CreateUser"),500,function(){function a(){nickForm.show(e,function(a){try{var e=mafia.createUser(f,a,g,b);mafia.player(m,e);mafia.ui.eventChange(!1)}catch(h){handleError(h)}})}var f=$("#form-name").val(),b=$("#form-male").attr("checked")?65:1,g=$("#form-email").val(),e={name:f,flags:b,nicks:{}},h=mafia.checkUser(f);null!=h?newUserForm.show(m,h,f,g,b&64):""==$("#form-email").val().trim()?
dlg.yesNo(l("EmptyEmail"),null,null,a):a()})}},selectClubForm=new function(){this.show=function(){var m=mafia.data().user.clubs;null==m||0==m.length?dlg.error(l("ErrNoClubs")):(m='<table class="dialog_form" width="100%"><tr><td width="120">'+l("Club")+':</td><td><select id="sc-club"></select></td></tr></table><script>selectClubForm.init()\x3c/script>',dlg.info(m,l("SelectClub"),null,function(){var a=parseInt($("#sc-club").val());mafia.data().club.id!=a&&mafia.sync(parseInt($("#sc-club").val()),0,
function(){mafia.ui.fillUsers()})}))};this.init=function(){var m=mafia.data().user.clubs,a="",h=mafia.data(),h=null!=h?h.game.club_id:-1;for(i=0;i<m.length;++i)var g=m[i],a=a+('<option value="'+g.id+'"'+(g.id==h?" selected":"")+">"+g.name+"</option>");$("#sc-club").html(a)}},settingsForm=new function(){this.show=function(){var m='<table class="dialog_form" width="100%"><tr><td width="200">'+l("SaveLocal")+':</td><td><select id="l-autosave"><option value="0">'+l("off")+'</option><option value="-1">'+
l("OnGameEnd")+'</option><option value="60">'+l("1min")+'</option><option value="30">'+l("30sec")+'</option><option value="20">'+l("20sec")+'</option><option value="10">'+l("10sec")+"</option></select></td></tr><tr><td>"+l("Sync")+':</td><td><select id="g-autosave"><option value="0">'+l("off")+'</option><option value="-1">'+l("OnGameEnd")+'</option><option value="1800">'+l("30min")+'</option><option value="600">'+l("10min")+'</option><option value="300">'+l("5min")+'</option><option value="120">'+
l("2min")+'</option><option value="60">'+l("1min")+"</option></select></td></tr><tr><td>"+l("TStart")+':</td><td><select id="t-start"><option value="1">'+l("on")+'</option><option value="0">'+l("off")+"</option></select></td></tr><tr><td>"+l("TSounds")+':</td><td><select id="t-sound"><option value="1">'+l("on")+'</option><option value="0">'+l("off")+"</option></select></td></tr><tr><td>"+l("TBlinking")+':</td><td><select id="t-blink"><option value="1">'+l("on")+'</option><option value="0">'+l("off")+
"</option></select></td></tr>";mafia.gameRules.flags&4096&&(m+="<tr><td>"+l("SimpVoting")+':</td><td><select id="s-client"><option value="1">'+l("on")+'</option><option value="0">'+l("off")+"</option></select></td></tr>");dlg.okCancel(m+"</table><script>settingsForm.init()\x3c/script>",l("Settings"),500,function(){var a=0;0!=$("#t-start").val()&&(a|=2);0==$("#t-sound").val()&&(a|=4);0==$("#t-blink").val()&&(a|=8);0!=$("#s-client").val()&&(a|=1);mafia.settings($("#l-autosave").val(),$("#g-autosave").val(),
a)})};this.init=function(){var m=mafia.data().user.settings,a=m.flags;$("#l-autosave").val(m.l_autosave);$("#g-autosave").val(m.g_autosave);$("#t-start").val(a&2?1:0);$("#t-sound").val(a&4?0:1);$("#t-blink").val(a&8?0:1);$("#s-client").val(a&1?1:0)}},gameStartForm=new function(){this.show=function(m){var a=mafia.data(),h=a.club,g=a.game,f=h.events[g.event_id],a='<table class="dialog_form" width="100%">';if(0==g.moder_id){var j=mafia.sReg(f.id),a=a+('<tr><td width="200">'+l("Moder")+':</td><td><select id="form-moder" onchange="gameStartForm.moder()"><option value="0" selected></option>'),
s;for(s in j)var t=j[s],a=a+('<option value="'+t+'">'+mafia.userTitle(t)+"</option>");a+="</select></td></tr>"}0==g.lang&&(f=f.langs,0==(f&3)&&(f=h.langs),0==(f&3)&&(f=3),a+='<tr><td width="200">'+l("Lang")+':</td><td><select id="form-lang" onchange="gameStartForm.lang()"><option value="0"></option>',f&1&&(a+='<option value="1">'+l("Eng")+"</option>"),f&2&&(a+='<option value="2">'+l("Rus")+"</option>"),a+="</select></td></tr>");if(0>=g.rules_id){g=mafia.sRules();a+='<tr><td width="200">'+l("Rules")+
':</td><td><select id="form-rules" onchange="gameStartForm.rules()"><option value="0"></option>';for(s in g)f=g[s],j=h.rules[f].name,0==j.length&&(j=l("DefRules")),status+='<option value="'+f+'">'+j+"</option>";status+="</select></td></tr>"}dlg.okCancel(a+"</table><script>gameStartForm.init()\x3c/script>",l("PleaseEnter"),500,m)};this.moder=function(){mafia.player(10,$("#form-moder").val());mafia.ui.eventChange(!1);gameStartForm.init()};this.lang=function(){mafia.setLang($("#form-lang").val());gameStartForm.init()};
this.rules=function(){mafia.setRules($("#form-rules").val());gameStartForm.init()};this.init=function(){$("dlg-ok").button("option","disabled",!mafia.canNext())}};setInterval(timer.tick,1E3);
